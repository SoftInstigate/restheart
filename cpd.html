<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 2.0.0-M3 from org.apache.maven.plugins:maven-pmd-plugin:3.17.0:aggregate-cpd at $dateFormat.format( $currentDate )

 | Rendered using Apache Maven Default Skin
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 2.0.0-M3" />
    <title>restheart-parent &#x2013; CPD Results</title>
    <link rel="stylesheet" href="./css/maven-base.css" />
    <link rel="stylesheet" href="./css/maven-theme.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
  </head>
  <body class="composite">
    <div id="banner">
<div id="bannerLeft">restheart-parent
</div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
      <div class="xleft">
        <span id="publishDate">Last Published: $dateValue</span>
           | <span id="projectVersion">Version: 6.4.1-SNAPSHOT</span>
      </div>
      <div class="xright"><a href="./" title="restheart-parent">restheart-parent</a>      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
       <h5>Modules</h5>
    <ul>
     <li class="none"><a href="restheart-commons/index.html" title="restheart-commons">restheart-commons</a></li>
     <li class="none"><a href="restheart-polyglot/index.html" title="restheart-polyglot">restheart-polyglot</a></li>
     <li class="none"><a href="restheart-graphql/index.html" title="restheart-graphql">restheart-graphql</a></li>
     <li class="none"><a href="restheart/index.html" title="restheart-core">restheart-core</a></li>
     <li class="none"><a href="restheart-security/index.html" title="restheart-security">restheart-security</a></li>
     <li class="none"><a href="restheart-mongodb/index.html" title="restheart-mongodb">restheart-mongodb</a></li>
     <li class="none"><a href="restheart-test-plugins/index.html" title="restheart-test-plugins">restheart-test-plugins</a></li>
    </ul>
       <h5>Project Documentation</h5>
    <ul>
     <li class="collapsed"><a href="project-info.html" title="Project Information">Project Information</a></li>
     <li class="expanded"><a href="project-reports.html" title="Project Reports">Project Reports</a>
      <ul>
       <li class="none"><a href="dependency-updates-report.html" title="Dependency Updates Report">Dependency Updates Report</a></li>
       <li class="none"><a href="plugin-updates-report.html" title="Plugin Updates Report">Plugin Updates Report</a></li>
       <li class="none"><a href="property-updates-report.html" title="Property Updates Report">Property Updates Report</a></li>
       <li class="none"><strong>CPD</strong></li>
       <li class="none"><a href="pmd.html" title="PMD">PMD</a></li>
      </ul></li>
    </ul>
    <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
      <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
    </a>
      </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
<section>
<h1><a name="CPD_Results"></a>CPD Results</h1>
<p>The following document contains the results of PMD's  <a class="externalLink" href="https://pmd.github.io/latest/pmd_userdocs_cpd.html">CPD</a> 6.46.0.</p></section><section>
<h1><a name="Duplications"></a>Duplications</h1>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org/restheart/ConfigurationHelper.java</td>
<td>restheart-core</td>
<td>43</td></tr>
<tr class="a">
<td>org/restheart/mongodb/ConfigurationHelper.java</td>
<td>restheart-mongodb</td>
<td>43</td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>private static final Set&lt;Option&lt;Long&gt;&gt; LONG_UNDERTOW_OPTIONS;

    static {
        UNDERTOW_OPTIONS = Sets.newHashSet();
        UNDERTOW_OPTIONS.add(UndertowOptions.ALLOW_ENCODED_SLASH);
        UNDERTOW_OPTIONS.add(UndertowOptions.ALLOW_EQUALS_IN_COOKIE_VALUE);
        UNDERTOW_OPTIONS.add(UndertowOptions.ALLOW_UNKNOWN_PROTOCOLS);
        UNDERTOW_OPTIONS.add(UndertowOptions.ALLOW_UNESCAPED_CHARACTERS_IN_URL);
        UNDERTOW_OPTIONS.add(UndertowOptions.ALWAYS_SET_DATE);
        UNDERTOW_OPTIONS.add(UndertowOptions.ALWAYS_SET_KEEP_ALIVE);
        UNDERTOW_OPTIONS.add(UndertowOptions.BUFFER_PIPELINED_DATA);
        UNDERTOW_OPTIONS.add(UndertowOptions.DECODE_URL);
        UNDERTOW_OPTIONS.add(UndertowOptions.ENABLE_HTTP2);
        UNDERTOW_OPTIONS.add(UndertowOptions.ENABLE_RFC6265_COOKIE_VALIDATION);
        UNDERTOW_OPTIONS.add(UndertowOptions.ENABLE_STATISTICS);
        UNDERTOW_OPTIONS.add(UndertowOptions.HTTP2_HUFFMAN_CACHE_SIZE);
        UNDERTOW_OPTIONS.add(UndertowOptions.HTTP2_SETTINGS_ENABLE_PUSH);
        UNDERTOW_OPTIONS.add(UndertowOptions.HTTP2_SETTINGS_HEADER_TABLE_SIZE);
        UNDERTOW_OPTIONS.add(UndertowOptions.HTTP2_SETTINGS_INITIAL_WINDOW_SIZE);
        UNDERTOW_OPTIONS.add(UndertowOptions.HTTP2_SETTINGS_MAX_CONCURRENT_STREAMS);
        UNDERTOW_OPTIONS.add(UndertowOptions.HTTP2_SETTINGS_MAX_FRAME_SIZE);
        UNDERTOW_OPTIONS.add(UndertowOptions.IDLE_TIMEOUT);
        UNDERTOW_OPTIONS.add(UndertowOptions.MAX_AJP_PACKET_SIZE);
        UNDERTOW_OPTIONS.add(UndertowOptions.MAX_BUFFERED_REQUEST_SIZE);
        UNDERTOW_OPTIONS.add(UndertowOptions.MAX_CACHED_HEADER_SIZE);
        UNDERTOW_OPTIONS.add(UndertowOptions.MAX_CONCURRENT_REQUESTS_PER_CONNECTION);
        UNDERTOW_OPTIONS.add(UndertowOptions.MAX_COOKIES);
        UNDERTOW_OPTIONS.add(UndertowOptions.MAX_HEADERS);
        UNDERTOW_OPTIONS.add(UndertowOptions.MAX_HEADER_SIZE);
        UNDERTOW_OPTIONS.add(UndertowOptions.MAX_PARAMETERS);
        UNDERTOW_OPTIONS.add(UndertowOptions.MAX_QUEUED_READ_BUFFERS);
        UNDERTOW_OPTIONS.add(UndertowOptions.NO_REQUEST_TIMEOUT);
        UNDERTOW_OPTIONS.add(UndertowOptions.RECORD_REQUEST_START_TIME);
        UNDERTOW_OPTIONS.add(UndertowOptions.REQUEST_PARSE_TIMEOUT);
        UNDERTOW_OPTIONS.add(UndertowOptions.REQUIRE_HOST_HTTP11);
        UNDERTOW_OPTIONS.add(UndertowOptions.SHUTDOWN_TIMEOUT);
        UNDERTOW_OPTIONS.add(UndertowOptions.SSL_USER_CIPHER_SUITES_ORDER);
        UNDERTOW_OPTIONS.add(UndertowOptions.URL_CHARSET);

        LONG_UNDERTOW_OPTIONS = Sets.newHashSet();
        LONG_UNDERTOW_OPTIONS.add(UndertowOptions.MAX_ENTITY_SIZE);
        LONG_UNDERTOW_OPTIONS.add(UndertowOptions.MULTIPART_MAX_ENTITY_SIZE);
    }

    @SuppressWarnings(&quot;unchecked&quot;)
    public static void setConnectionOptions(Builder builder, Configuration configuration) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org/restheart/mongodb/handlers/bulk/BulkResultRepresentationFactory.java</td>
<td>restheart-mongodb</td>
<td>82</td></tr>
<tr class="a">
<td>org/restheart/mongodb/handlers/bulk/BulkResultRepresentationFactory.java</td>
<td>restheart-mongodb</td>
<td>116</td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>if (wr.wasAcknowledged()) {
            if (wr.getUpserts() != null || wr.getInserts() != null) {
                rep.put(&quot;inserted&quot;, new BsonInt32((wr.getUpserts() != null ? wr.getUpserts().size() : 0)
                        + (wr.getInserts() != null ? wr.getInserts().size() : 0)));

                var links = new BsonArray();

                // add links to new, upserted documents
                if (wr.getUpserts() != null) {
                        wr.getUpserts().stream().forEach(update -&gt; links.add(new BsonString(
                                RepresentationUtils.getReferenceLink(requestPath, update.getId()))));
                }

                // add links to new, inserted documents
                if (wr.getInserts() != null) {
                        wr.getInserts().stream().forEach(update -&gt; links.add(new BsonString(
                                        RepresentationUtils.getReferenceLink(requestPath,update.getId()))));
                }

                rep.put(&quot;links&quot;, links);
            }

            rep.put(&quot;deleted&quot;,
                    new BsonInt32(wr.getDeletedCount()));

            rep.put(&quot;modified&quot;,
                    new BsonInt32(wr.getModifiedCount()));

            rep.put(&quot;matched&quot;,
                    new BsonInt32(wr.getMatchedCount()));
        }
    }

    private void addWriteResult(final BulkWriteResult wr, final BsonDocument rep, final String requestPath) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org/restheart/utils/LoggingInitializer.java</td>
<td>restheart-core</td>
<td>60</td></tr>
<tr class="a">
<td>org/restheart/mongodb/utils/LoggingInitializer.java</td>
<td>restheart-mongodb</td>
<td>63</td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>orgLogger.setLevel(level);

        if (logbackConfigurationFile != null &amp;&amp; !logbackConfigurationFile.isEmpty()) {
            comLogger.info(&quot;Loglevel was set via logback configuration file with level {}&quot;, comLogger.getLevel());
            level = comLogger.getLevel();
        }

        comLogger.setLevel(level);
    }

    /**
     *
     */
    public static void stopConsoleLogging() {
        LoggerContext loggerContext = (LoggerContext) LoggerFactory.getILoggerFactory();
        Logger rootLogger = loggerContext.getLogger(Logger.ROOT_LOGGER_NAME);

        Appender&lt;ILoggingEvent&gt; appender = rootLogger.getAppender(&quot;STDOUT&quot;);

        appender.stop();
    }

    /**
     *
     * @param logFilePath
     */
    public static void startFileLogging(String logFilePath) {
        Logger rootLogger = (Logger) LoggerFactory.getLogger(Logger.ROOT_LOGGER_NAME);

        LoggerContext loggerContext = rootLogger.getLoggerContext();

        RollingFileAppender&lt;ILoggingEvent&gt; rfAppender = new RollingFileAppender&lt;&gt;();
        rfAppender.setContext(loggerContext);
        rfAppender.setFile(logFilePath);

        FixedWindowRollingPolicy fwRollingPolicy = new FixedWindowRollingPolicy();
        fwRollingPolicy.setContext(loggerContext);
        fwRollingPolicy.setFileNamePattern(logFilePath + &quot;-%i.log.zip&quot;);
        fwRollingPolicy.setParent(rfAppender);
        fwRollingPolicy.start();

        SizeBasedTriggeringPolicy&lt;ILoggingEvent&gt; triggeringPolicy = new SizeBasedTriggeringPolicy&lt;&gt;();
        triggeringPolicy.setMaxFileSize(FileSize.valueOf(&quot;5 mb&quot;));
        triggeringPolicy.start();

        PatternLayoutEncoder encoder = new PatternLayoutEncoder();
        encoder.setContext(loggerContext);
        encoder.setPattern(&quot;%d{HH:mm:ss.SSS} [%thread] %highlight(%-5level) %logger{36} - %msg%n&quot;);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org/restheart/Configuration.java</td>
<td>restheart-commons</td>
<td>251</td></tr>
<tr class="a">
<td>org/restheart/mongodb/MongoServiceConfiguration.java</td>
<td>restheart-mongodb</td>
<td>439</td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>}
    }

    /**
     *
     * @param key
     * @return the environment or java property variable, if found
     */
    private static String overriddenValueFromEnv(final String confParameter) {
        var value = _overriddenValueFromEnv(&quot;RH&quot;, confParameter);

        if (value != null) {
            return value;
        }

        value = _overriddenValueFromEnv(&quot;RESTHEART&quot;, confParameter);

        if (value != null) {
            return value;
        }

        // legacy variable pattern
        value = _overriddenValueFromEnv(&quot;RESTHEART_SECURITY&quot;, confParameter);

        if (value != null) {
            return value;
        }

        // no prefix
        value = _overriddenValueFromEnv(null, confParameter);

        if (value != null) {
            return value;
        }

        return null;
    }

    private static String _overriddenValueFromEnv(final String prefix, final String confParameter) {
        var key = prefix != null ? prefix + &quot;_&quot; + confParameter.toUpperCase().replaceAll(&quot;-&quot;, &quot;_&quot;)
                : confParameter.toUpperCase().replaceAll(&quot;-&quot;, &quot;_&quot;);

        return __overriddenValueFromEnv(confParameter, key);
    }

    private static String __overriddenValueFromEnv(final String confParameter, final String key) {

        String envValue = System.getProperty(key);

        if (envValue == null) {
            envValue = System.getenv(key);
        }

        if (null != envValue) {
            LOGGER.warn(&quot;&gt;&gt;&gt; Found environment variable '{}': overriding parameter '{}' with value '{}'&quot;, key,
                    confParameter, envValue);
        }
        return envValue;
    }

    /**
     * this checks if an old (&lt; 2.0) configuration is found
     *
     * old format:
     *
     * &lt;pre&gt;
     * auth-mechanisms:
     *  - name: basicAuthMechanism
     *    class: org.restheart.security.mechanisms.BasicAuthMechanism
     *    args:
     *      argParam1: value
     *      argParam2: value
     * &lt;/pre&gt;
     *
     * new format
     *
     * &lt;pre&gt;
     * auth-mechanisms:
     *  - basicAuthMechanism:
     *      argParam1: value
     *      argParam2: value
     * &lt;/pre&gt;
     *
     * @param conf
     * @return true if an old (&lt; 2.0) configuration is found
     */
    private static boolean checkPre20Confs(List&lt;Map&lt;String, Object&gt;&gt; conf) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org/restheart/Configuration.java</td>
<td>restheart-commons</td>
<td>179</td></tr>
<tr class="a">
<td>org/restheart/mongodb/MongoServiceConfiguration.java</td>
<td>restheart-mongodb</td>
<td>125</td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>try (FileInputStream fis = new FileInputStream(confFilePath.toFile())) {
            conf = (Map&lt;String, Object&gt;) yaml.load(fis);
        } catch (FileNotFoundException fne) {
            throw new ConfigurationException(&quot;Configuration file not found&quot;, fne);
        } catch (Throwable t) {
            throw new ConfigurationException(&quot;Error parsing the configuration file&quot;, t);
        }

        return conf;
    }

    static boolean isParametric(final Path confFilePath) throws IOException {
        try (var sc = new Scanner(confFilePath, &quot;UTF-8&quot;)) {
            return sc.findAll(Pattern.compile(&quot;\\{\\{.*\\}\\}&quot;)).limit(1).count() &gt; 0;
        }
    }

    /**
     *
     * @param integers
     * @return
     */
    public static int[] convertListToIntArray(List&lt;Object&gt; integers) {
        int[] ret = new int[integers.size()];
        Iterator&lt;Object&gt; iterator = integers.iterator();
        for (int i = 0; i &lt; ret.length; i++) {
            Object o = iterator.next();

            if (o instanceof Integer) {
                ret[i] = (Integer) o;
            } else {
                return new int[0];
            }
        }

        return ret;
    }</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org/restheart/security/AclVarsInterpolator.java</td>
<td>restheart-commons</td>
<td>500</td></tr>
<tr class="a">
<td>org/restheart/mongodb/interceptors/AddRequestProperties.java</td>
<td>restheart-mongodb</td>
<td>208</td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>properties.put(&quot;epochTimeStamp&quot;, new BsonDateTime(Instant.now().getEpochSecond() * 1000));

        // dateTime
        properties.put(&quot;dateTime&quot;, new BsonString(ExchangeAttributes.dateTime().readAttribute(exchange)));

        // local ip
        properties.put(&quot;localIp&quot;, new BsonString(ExchangeAttributes.localIp().readAttribute(exchange)));

        // local port
        properties.put(&quot;localPort&quot;, new BsonString(ExchangeAttributes.localPort().readAttribute(exchange)));

        // local server name
        properties.put(&quot;localServerName&quot;, new BsonString(ExchangeAttributes.localServerName().readAttribute(exchange)));

        // request query string
        properties.put(&quot;queryString&quot;, new BsonString(ExchangeAttributes.queryString().readAttribute(exchange)));

        // request relative path
        properties.put(&quot;relativePath&quot;, new BsonString(ExchangeAttributes.relativePath().readAttribute(exchange)));

        // remote ip
        properties.put(&quot;remoteIp&quot;, new BsonString(ExchangeAttributes.remoteIp().readAttribute(exchange)));

        // request method
        properties.put(&quot;method&quot;, new BsonString(ExchangeAttributes.requestMethod().readAttribute(exchange)));</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org/restheart/exchange/Request.java</td>
<td>restheart-commons</td>
<td>149</td></tr>
<tr class="a">
<td>org/restheart/exchange/Response.java</td>
<td>restheart-commons</td>
<td>136</td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>return wrapped.getRequestHeaders();
    }

    /**
     * note: an header can have multiple values. This only returns the first one.
     * use getHeaders() to get all the header's values
     *
     * @param name the name of the header to return
     * @return the first value of the header
     */
    public String getHeader(String name) {
        return getHeaders().getFirst(HttpString.tryFromString(name));
    }

    /**
     * note: an header can have multiple values. This sets the given value clearing
     * existing ones. use getHeaders().add(value) to add the value without clearing.
     *
     * @param name the name of the header to return
     */
    public void setHeader(HttpString name, String value) {
        if (getHeaders().get(name) == null) {
            getHeaders().put(name, value);
        } else {
            getHeaders().get(name).clear();
            getHeaders().get(name).add(value);
        }
    }

    /**
     * note: an header can have multiple values. This sets the given value clearing
     * existing ones. use getHeaders().add(value) to add the value without clearing.
     *
     * @param name the name of the header to return
     */
    public void setHeader(String name, String value) {
        if (getHeaders().get(name) == null) {
            getHeaders().put(HttpString.tryFromString(name), value);
        } else {
            getHeaders().get(HttpString.tryFromString(name)).clear();
            getHeaders().get(HttpString.tryFromString(name)).add(value);
        }
    }

    /**
     * @param name the name of the cookie to return
     * @return a the cookie
     */
    public Cookie getCookie(String name) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org/restheart/mongodb/handlers/schema/JsonMetaSchemaChecker.java</td>
<td>restheart-mongodb</td>
<td>88</td></tr>
<tr class="a">
<td>org/restheart/mongodb/interceptors/JsonSchemaBeforeWriteChecker.java</td>
<td>restheart-mongodb</td>
<td>180</td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>schema.validate(new JSONObject(contentToCheck.toString()));
        } catch (ValidationException ve) {
            var errors = new ArrayList&lt;String&gt;();

            errors.add(ve.getMessage().replaceAll(&quot;#: &quot;, &quot;&quot;));

            ve.getCausingExceptions().stream()
                    .map(ValidationException::getMessage)
                    .forEach(errors::add);

            var errMsgBuilder = new StringBuilder();

            errors.stream()
                    .map(e -&gt; e.replaceAll(&quot;#: &quot;, &quot;&quot;))
                    .forEachOrdered(e -&gt; errMsgBuilder.append(e).append(&quot;, &quot;));

            var errMsg = errMsgBuilder.toString();

            if (errMsg.length() &gt; 2
                    &amp;&amp; &quot;, &quot;.equals(errMsg.substring(errMsg.length() - 2, errMsg.length()))) {
                errMsg = errMsg.substring(0, errMsg.length() - 2);

            }

            response.setInError(HttpStatus.SC_BAD_REQUEST,</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org/restheart/ConfigurationHelper.java</td>
<td>restheart-core</td>
<td>88</td></tr>
<tr class="a">
<td>org/restheart/mongodb/ConfigurationHelper.java</td>
<td>restheart-mongodb</td>
<td>95</td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>public static void setConnectionOptions(Builder builder, Configuration configuration) {

        Map&lt;String, Object&gt; options = configuration.getConnectionOptions();

        UNDERTOW_OPTIONS.stream().forEach(option -&gt; {
            if (options.containsKey(option.getName())) {
                Object value = options.get(option.getName());

                if (value != null) {
                    builder.setServerOption(option, value);
                    LOGGER.trace(&quot;Connection option {}={}&quot;, option.getName(), value);
                }
            }
        });

        LONG_UNDERTOW_OPTIONS.stream().forEach(option -&gt; {
            if (options.containsKey(option.getName())) {
                Object value = options.get(option.getName());

                if (value != null) {
                    Long lvalue = 0l + (Integer) value;
                    builder.setServerOption(option, lvalue);
                    LOGGER.trace(&quot;Connection option {}={}&quot;, option.getName(), lvalue);
                }
            }
        });
    }</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org/restheart/utils/LogUtils.java</td>
<td>restheart-commons</td>
<td>33</td></tr>
<tr class="a">
<td>org/restheart/mongodb/utils/LogUtils.java</td>
<td>restheart-mongodb</td>
<td>35</td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>public class LogUtils {
    public static enum Level {
        TRACE, DEBUG, INFO, WARN, ERROR
    }

    public static void log(Logger logger, Level level, String format, Object... argArray) {
        if (logger != null &amp;&amp; level != null) {
            switch (level) {
                case TRACE:
                    logger.trace(format, argArray);
                    break;
                case DEBUG:
                    logger.debug(format, argArray);
                    break;
                case INFO:
                    logger.info(format, argArray);
                    break;
                case WARN:
                    logger.warn(format, argArray);
                    break;
                case ERROR:
                    logger.error(format, argArray);
                    break;
            }
        }
    }

    public static void boxedError(
            Logger LOGGER,
            String... rows) {
        boxedMessage(LOGGER, Level.ERROR, RED, GREEN, rows);
    }

    public static void boxedWarn(
            Logger LOGGER,
            String... rows) {
        boxedMessage(LOGGER, Level.WARN, RED, GREEN, rows);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org/restheart/mongodb/handlers/database/PatchDBHandler.java</td>
<td>restheart-mongodb</td>
<td>87</td></tr>
<tr class="a">
<td>org/restheart/mongodb/handlers/database/PutDBHandler.java</td>
<td>restheart-mongodb</td>
<td>83</td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>}

        // cannot PATCH an array
        if (!_content.isDocument()) {
            response.setInError(HttpStatus.SC_NOT_ACCEPTABLE, &quot;data must be a json object&quot;);
            next(exchange);
            return;
        }

        var content = _content.asDocument();

        var result = dbs.upsertDB(
            Optional.ofNullable(request.getClientSession()),
            request.rsOps(),
            request.getDBName(),
            request.getMethod(),
            request.getDbProps() != null, // true if updating
            content,
            request.getETag(),
            request.isETagCheckRequired());

        response.setDbOperationResult(result);

        // inject the etag
        if (result.getEtag() != null) {
            ResponseHelper.injectEtagHeader(exchange, result.getEtag());
        }

        if (result.getHttpCode() == HttpStatus.SC_CONFLICT) {
            response.setInError(HttpStatus.SC_CONFLICT, &quot;The database's ETag must be provided using the '&quot; + Headers.IF_MATCH + &quot;' header.&quot;);
            next(exchange);
            return;
        }</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org/restheart/exchange/ByteArrayProxyResponse.java</td>
<td>restheart-commons</td>
<td>96</td></tr>
<tr class="a">
<td>org/restheart/exchange/JsonProxyResponse.java</td>
<td>restheart-commons</td>
<td>103</td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>protected byte[] getErrorContent(int code, String httpStatusText, String message, Throwable t, boolean includeStackTrace) throws IOException {
        var resp = new JsonObject();
        resp.add(&quot;http status code&quot;, new JsonPrimitive(code));
        resp.add(&quot;http status description&quot;, new JsonPrimitive(httpStatusText));
        if (message != null) {
            resp.add(&quot;message&quot;, new JsonPrimitive(avoidEscapedChars(message)));
        }
        var nrep = new JsonObject();
        if (t != null) {
            nrep.add(&quot;class&quot;, new JsonPrimitive(t.getClass().getName()));
            if (includeStackTrace) {
                JsonArray stackTrace = getStackTrace(t);
                if (stackTrace != null) {
                    nrep.add(&quot;stack trace&quot;, stackTrace);
                }
            }
            resp.add(&quot;exception&quot;, nrep);
        }
        return resp.toString().getBytes();</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org/restheart/plugins/PluginsFactory.java</td>
<td>restheart-core</td>
<td>355</td></tr>
<tr class="a">
<td>org/restheart/plugins/PluginsFactory.java</td>
<td>restheart-core</td>
<td>428</td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>.filter(p -&gt; p.methodHash == injection.methodHash).count() == 1) {

                // check configuration scope
                var allConfScope = injection.params.stream()
                        .anyMatch(p -&gt; &quot;scope&quot;.equals(p.getKey())
                                &amp;&amp; (ConfigurationScope.class.getName() + &quot;.&quot; + ConfigurationScope.ALL.name())
                                        .equals(p.getValue().toString()));

                var scopedConf = (Map) (allConfScope ? Bootstrapper.getConfiguration().toMap()
                        : ip.confs != null ? ip.confs.get(ip.name) : null);

                if (scopedConf == null) {
                    LOGGER.warn(
                            &quot;{} {} defines method {} with @InjectConfiguration &quot; + &quot;but no configuration found for it&quot;,
                            ip.type, ip.name, injection.method);
                }

                // try to inovke @InjectConfiguration method
                try {
                    ip.clazz.getDeclaredMethod(injection.method, Map.class).invoke(ip.instance, scopedConf);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org/restheart/mongodb/handlers/aggregation/AbstractAggregationOperation.java</td>
<td>restheart-mongodb</td>
<td>110</td></tr>
<tr class="a">
<td>org/restheart/mongodb/handlers/changestreams/ChangeStreamOperation.java</td>
<td>restheart-mongodb</td>
<td>81</td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>}

    /**
     * checks if the aggregation variable start with $ this is not allowed since
     * the client would be able to modify the aggregation stages
     *
     * @param aVars RequestContext.getAggregationVars()
     */
    public static void checkAggregationVariables(BsonValue aVars) throws SecurityException {
        if (aVars == null) {
            return;
        }

        if (aVars.isDocument()) {
            var _obj = aVars.asDocument();

            _obj.forEach((key, value) -&gt; {
                if (key.startsWith(&quot;$&quot;)) {
                    throw new SecurityException(&quot;aggregation variables cannot include operators&quot;);
                }

                if (value.isDocument() || value.isArray()) {
                    checkAggregationVariables(value);
                }
            });
        } else if (aVars.isArray()) {
            aVars.asArray().getValues().stream()
                    .filter(el -&gt; (el.isDocument() || el.isArray()))
                    .forEachOrdered(AbstractAggregationOperation::checkAggregationVariables);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org/restheart/Version.java</td>
<td>restheart-commons</td>
<td>115</td></tr>
<tr class="a">
<td>org/restheart/utils/FileUtils.java</td>
<td>restheart-core</td>
<td>209</td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>Set&lt;Map.Entry&lt;Object, Object&gt;&gt; result = null;
        try {
            Enumeration&lt;URL&gt; resources = Thread.currentThread().getContextClassLoader()
                    .getResources(&quot;META-INF/MANIFEST.MF&quot;);
            while (resources.hasMoreElements()) {
                URL manifestUrl = resources.nextElement();
                Manifest manifest = new Manifest(manifestUrl.openStream());
                Attributes mainAttributes = manifest.getMainAttributes();
                String implementationTitle = mainAttributes.getValue(&quot;Implementation-Title&quot;);
                if (implementationTitle != null &amp;&amp; implementationTitle.toLowerCase().startsWith(&quot;restheart&quot;)) {
                    result = mainAttributes.entrySet();
                    break;
                }
            }
        } catch (IOException e) {
            LOGGER.warn(e.getMessage());
        }
        return result;
    }</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org/restheart/mongodb/db/Documents.java</td>
<td>restheart-mongodb</td>
<td>392</td></tr>
<tr class="a">
<td>org/restheart/mongodb/db/GridFs.java</td>
<td>restheart-mongodb</td>
<td>399</td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>return new OperationResult(HttpStatus.SC_CONFLICT, oldEtag, oldDocument, null);
        }

        BsonValue _requestEtag;

        if (ObjectId.isValid(requestEtag)) {
            _requestEtag = new BsonObjectId(new ObjectId(requestEtag));
        } else {
            // restheart generates ObjectId etags, but here we support
            // strings as well
            _requestEtag = new BsonString(requestEtag);
        }

        if (Objects.equals(_requestEtag, oldEtag)) {
            var query = eq(&quot;_id&quot;, oldDocument.get(&quot;_id&quot;));

            var newDocument = cs.isPresent() ? coll.find(cs.get(), query).first() : coll.find(query).first();

            return new OperationResult(httpStatusIfOk, newEtag, oldDocument, newDocument);
        } else {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org/restheart/graphql/interceptors/GraphAppDefinitionEscaper.java</td>
<td>restheart-graphql</td>
<td>45</td></tr>
<tr class="a">
<td>org/restheart/graphql/interceptors/GraphAppDefinitionPutPostChecker.java</td>
<td>restheart-graphql</td>
<td>48</td></tr>
<tr class="b">
<td>org/restheart/graphql/interceptors/GraphAppDefinitionPutPostEscaper.java</td>
<td>restheart-graphql</td>
<td>45</td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>public class GraphAppDefinitionEscaper implements MongoInterceptor {
    private String db = GraphQLService.DEFAULT_APP_DEF_DB;
    private String coll = GraphQLService.DEFAULT_APP_DEF_COLLECTION;

    private boolean enabled = false;

    @InjectConfiguration(scope = ConfigurationScope.ALL)
    public void conf(Map&lt;String, Object&gt; args) {
        try {
            Map&lt;String, Object&gt; pluginsArgs = arg(args, ConfigurationKeys.PLUGINS_ARGS_KEY);
            Map&lt;String, Object&gt; graphqlArgs = arg(pluginsArgs, &quot;graphql&quot;);

            this.db = arg(graphqlArgs, &quot;db&quot;);
            this.coll = arg(graphqlArgs, &quot;collection&quot;);
        } catch(ConfigurationException ce) {
            // nothing to do, using default values
        }

        this.enabled = true;
    }

    @Override
    public void handle(MongoRequest request, MongoResponse response) throws Exception {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org/restheart/security/authorizers/FileAclAuthorizer.java</td>
<td>restheart-security</td>
<td>190</td></tr>
<tr class="b">
<td>org/restheart/security/authorizers/MongoAclAuthorizer.java</td>
<td>restheart-security</td>
<td>244</td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>public boolean isAuthenticationRequired(Request&lt;?&gt; request) {
        // don't require authentication for OPTIONS requests
        if (request.isOptions()) {
            return false;
        }

        var exchange = request.getExchange();

        var ps = rolePermissions($UNAUTHENTICATED);

        if (ps != null) {
            // this fixes undertow bug 377
            // https://issues.jboss.org/browse/UNDERTOW-377
            if (exchange.getAttachment(PREDICATE_CONTEXT) == null) {
                exchange.putAttachment(PREDICATE_CONTEXT, new TreeMap&lt;&gt;());
            }

            // Predicate.resolve() uses getRelativePath() that is the path relative to
            // the last PathHandler we want to check against the full request path
            // see https://issues.jboss.org/browse/UNDERTOW-1317
            exchange.setRelativePath(request.getPath());

            return !ps.stream().anyMatch(r -&gt; r.allow(request));
        } else {
            return true;
        }
    }

    private Stream&lt;String&gt; roles(HttpServerExchange exchange) {
        return account(exchange).getRoles().stream();
    }

    private LinkedHashSet&lt;FileAclPermission&gt; rolePermissions(final String role) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org/restheart/plugins/PluginsFactory.java</td>
<td>restheart-core</td>
<td>294</td></tr>
<tr class="b">
<td>org/restheart/plugins/PluginsFactory.java</td>
<td>restheart-core</td>
<td>316</td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>invokeCoreInjectMethods(ip);
            } catch (InvocationTargetException ite) {
                if (ite.getCause() != null &amp;&amp; ite.getCause() instanceof NoClassDefFoundError) {
                    var errMsg = &quot;Error handling the request. &quot; + &quot;An external dependency is missing for &quot; + ip.type
                            + &quot; &quot; + ip.name + &quot;. Copy the missing dependency jar to the plugins directory &quot;
                            + &quot;to add it to the classpath&quot;;

                    LOGGER.error(errMsg, ite);
                } else {
                    LOGGER.error(&quot;Error injecting dependency to {} {}: {}&quot;, ip.type, ip.name,
                            getRootException(ite).getMessage(), ite);
                }
            } catch (ConfigurationException | InstantiationException | IllegalAccessException ex) {
                LOGGER.error(&quot;Error injecting dependency to {} {}: {}&quot;, ip.type, ip.name,
                        getRootException(ex).getMessage(), ex);
            }
        }
    }</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org/restheart/polyglot/PolyglotDeployer.java</td>
<td>restheart-polyglot</td>
<td>387</td></tr>
<tr class="b">
<td>org/restheart/polyglot/PolyglotDeployer.java</td>
<td>restheart-polyglot</td>
<td>423</td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>srv.getDescription(),
                srv.isSecured(),
                true,
                srv.getClass().getName(),
                srv,
                new HashMap&lt;&gt;());

            registry.plugService(record, srv.getUri(), srv.getMatchPolicy(), srv.isSecured());

            DEPLOYEES.put(pluginPath.toAbsolutePath(), srv);

            LOGGER.info(ansi().fg(GREEN).a(&quot;URI {} bound to service {}, description: {}, secured: {}, uri match {}&quot;).reset().toString(),
                srv.getUri(), srv.getName(), srv.getDescription(), srv.isSecured(), srv.getMatchPolicy());
        } catch(IllegalArgumentException | IllegalStateException e) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org/restheart/utils/LoggingInitializer.java</td>
<td>restheart-core</td>
<td>107</td></tr>
<tr class="b">
<td>org/restheart/mongodb/utils/LoggingInitializer.java</td>
<td>restheart-mongodb</td>
<td>110</td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>encoder.setPattern(&quot;%d{HH:mm:ss.SSS} [%thread] %highlight(%-5level) %logger{36} - %msg%n&quot;);
        encoder.start();

        rfAppender.setEncoder(encoder);
        rfAppender.setName(&quot;ROLLINGFILE&quot;);
        rfAppender.setRollingPolicy(fwRollingPolicy);
        rfAppender.setTriggeringPolicy(triggeringPolicy);
        rfAppender.start();

        AsyncAppender asyncAppender = new AsyncAppender();
        asyncAppender.setContext(loggerContext);
        asyncAppender.setName(&quot;ASYNC&quot;);
        asyncAppender.setQueueSize(ASYNC_QUEUE_SIZE);
        asyncAppender.setMaxFlushTime(ASYNC_MAX_FLUSH_TIME);
        asyncAppender.addAppender(rfAppender);
        asyncAppender.start();

        rootLogger.addAppender(asyncAppender);
    }

    public static void stopLogging() {
        Logger root = (Logger) LoggerFactory.getLogger(Logger.ROOT_LOGGER_NAME);
        root.getLoggerContext().stop();
    }

    private LoggingInitializer() {
    }
}</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org/restheart/mongodb/hal/BulkResultRepresentationFactory.java</td>
<td>restheart-mongodb</td>
<td>93</td></tr>
<tr class="b">
<td>org/restheart/mongodb/hal/BulkResultRepresentationFactory.java</td>
<td>restheart-mongodb</td>
<td>131</td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>BulkWriteResult wr = result.getBulkResult();

        if (wr.wasAcknowledged()) {
            if (wr.getUpserts() != null || wr.getInserts() != null) {
                    nrep.addProperty(&quot;inserted&quot;, new BsonInt32(
                            (wr.getUpserts() != null ? wr.getUpserts().size() : 0) +
                            (wr.getInserts() != null ? wr.getInserts().size() : 0)));

                    // add links to new, upserted documents
                    if (wr.getUpserts() != null) {
                            wr.getUpserts().stream().forEach(update -&gt; nrep.addLink(new Link(&quot;rh:newdoc&quot;,
                                            RepresentationUtils.getReferenceLink(response, requestPath, update.getId())), true));</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org/restheart/mongodb/handlers/changestreams/ChangeStreamSubscriber.java</td>
<td>restheart-mongodb</td>
<td>129</td></tr>
<tr class="b">
<td>org/restheart/mongodb/handlers/changestreams/ObsoleteChangeStreamRemover.java</td>
<td>restheart-mongodb</td>
<td>88</td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>private void closeAllOnError(String db, String collection) {
        var webSocketSessions = WebSocketSessionsRegistry.getInstance();
        var changeStreams = ChangeStreamsRegistry.getInstance();

        var sessionKeys = changeStreams.getSessionKeysOnCollection(db, collection);

        sessionKeys.stream()
            .collect(Collectors.toSet())
            .forEach(sk -&gt; {
            var _webSocketSession = webSocketSessions.get(sk);
            _webSocketSession.stream()
                .collect(Collectors.toSet())
                .forEach(wss -&gt; {
                    try {
                        wss.close();
                        webSocketSessions.remove(sk, wss);
                    } catch(IOException ioe) {
                        // LOGGER
                    }
            });

            changeStreams.remove(sk);
        });
    }</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org/restheart/security/authenticators/DenyFilterOnUserPwd.java</td>
<td>restheart-security</td>
<td>57</td></tr>
<tr class="b">
<td>org/restheart/security/authenticators/UserPwdRemover.java</td>
<td>restheart-security</td>
<td>56</td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>@InjectPluginsRegistry
    public void init(PluginsRegistry registry) {
        PluginRecord&lt;Authenticator&gt; _mra;

        try {
            _mra = registry.getAuthenticator(&quot;mongoRealmAuthenticator&quot;);
        } catch (ConfigurationException ce) {
            enabled = false;
            return;
        }

        if (_mra == null || !_mra.isEnabled()) {
            enabled = false;
        } else {
            var rhAuth = (MongoRealmAuthenticator) _mra.getInstance();

            this.usersDb = rhAuth.getUsersDb();
            this.usersCollection = rhAuth.getUsersCollection();
            this.propNamePassword = rhAuth.getPropPassword();

            if (usersDb == null
                    || usersCollection == null
                    || propNamePassword == null) {
                LOGGER.error(&quot;Wrong configuration of mongoRealmAuthenticator! &quot;
                        + &quot;Requests with filters on the password property &quot;</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org/restheart/Bootstrapper.java</td>
<td>restheart-core</td>
<td>523</td></tr>
<tr class="b">
<td>org/restheart/Bootstrapper.java</td>
<td>restheart-core</td>
<td>565</td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>.filter(i -&gt; initPoint(i.getInstance()) == BEFORE_STARTUP)
            .forEach(i -&gt; {
                try {
                    i.getInstance().init();
                } catch (NoClassDefFoundError iae) {
                    // this occurs executing interceptors missing external dependencies
                    LOGGER.error(&quot;Error executing initializer {}. An external dependency is missing. Copy the missing dependency jar to the plugins directory to add it to the classpath&quot;, i.getName(), iae);
                } catch (LinkageError le) {
                    // this occurs executing plugin code compiled
                    // with wrong version of restheart-commons

                    var version = Version.getInstance().getVersion() == null
                        ? &quot;of correct version&quot;
                        : &quot;v&quot; + Version.getInstance().getVersion();

                    LOGGER.error(&quot;Linkage error executing initializer {}. Check that it was compiled against restheart-commons {}&quot;, i.getName(), version, le);
                } catch (Throwable t) {
                    LOGGER.error(&quot;Error executing initializer {}&quot;, i.getName());</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org/restheart/utils/OSChecker.java</td>
<td>restheart-core</td>
<td>27</td></tr>
<tr class="b">
<td>org/restheart/mongodb/utils/OSChecker.java</td>
<td>restheart-mongodb</td>
<td>27</td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>public class OSChecker {

    private static final String OS = System.getProperty(&quot;os.name&quot;).toLowerCase();

    public static boolean isWindows() {
        return OS.contains(&quot;win&quot;);
    }

    public static boolean isMac() {
        return OS.contains(&quot;mac&quot;);
    }

    public static boolean isUnix() {
        return OS.contains(&quot;nix&quot;) || OS.contains(&quot;nux&quot;) || OS.indexOf(&quot;aix&quot;) &gt; 0;
    }

    public static boolean isSolaris() {
        return OS.contains(&quot;sunos&quot;);
    }

    private OSChecker() {
    }
}</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org/restheart/graphql/interceptors/GraphAppDefinitionEscaper.java</td>
<td>restheart-graphql</td>
<td>51</td></tr>
<tr class="b">
<td>org/restheart/graphql/interceptors/GraphAppDefinitionPatchChecker.java</td>
<td>restheart-graphql</td>
<td>62</td></tr>
<tr class="a">
<td>org/restheart/graphql/interceptors/GraphAppDefinitionPutPostChecker.java</td>
<td>restheart-graphql</td>
<td>54</td></tr>
<tr class="b">
<td>org/restheart/graphql/interceptors/GraphAppDefinitionPutPostEscaper.java</td>
<td>restheart-graphql</td>
<td>51</td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>@InjectConfiguration(scope = ConfigurationScope.ALL)
    public void conf(Map&lt;String, Object&gt; args) {
        try {
            Map&lt;String, Object&gt; pluginsArgs = arg(args, ConfigurationKeys.PLUGINS_ARGS_KEY);
            Map&lt;String, Object&gt; graphqlArgs = arg(pluginsArgs, &quot;graphql&quot;);

            this.db = arg(graphqlArgs, &quot;db&quot;);
            this.coll = arg(graphqlArgs, &quot;collection&quot;);
        } catch(ConfigurationException ce) {
            // nothing to do, using default values
        }

        this.enabled = true;
    }

    @Override
    public void handle(MongoRequest request, MongoResponse response) throws Exception {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org/restheart/mongodb/handlers/collection/PostCollectionHandler.java</td>
<td>restheart-mongodb</td>
<td>58</td></tr>
<tr class="b">
<td>org/restheart/mongodb/handlers/collection/PutCollectionHandler.java</td>
<td>restheart-mongodb</td>
<td>53</td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>public PostCollectionHandler(PipelinedHandler next) {
        super(next);
    }


    /**
     *
     * @param exchange
     * @throws Exception
     */
    @Override
    public void handleRequest(HttpServerExchange exchange) throws Exception {
        var request = MongoRequest.of(exchange);
        var response = MongoResponse.of(exchange);

        if (request.isInError()) {
            next(exchange);
            return;
        }

        var _content = request.getContent();

        if (_content == null) {
            _content = new BsonDocument();
        }

        // cannot POST an array
        if (!_content.isDocument()) {
            response.setInError(HttpStatus.SC_NOT_ACCEPTABLE, &quot;data must be a json object&quot;);
            next(exchange);
            return;
        }</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org/restheart/mongodb/handlers/collection/DeleteCollectionHandler.java</td>
<td>restheart-mongodb</td>
<td>55</td></tr>
<tr class="b">
<td>org/restheart/mongodb/handlers/database/DeleteDBHandler.java</td>
<td>restheart-mongodb</td>
<td>57</td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>public DeleteCollectionHandler(PipelinedHandler next) {
        super(next);
    }

    /**
     *
     * @param exchange
     * @throws Exception
     */
    @Override
    public void handleRequest(HttpServerExchange exchange) throws Exception {
        var request = MongoRequest.of(exchange);
        var response = MongoResponse.of(exchange);

        if (request.isInError()) {
            next(exchange);
            return;
        }

        var etag = request.getETag() == null
                ? null
                : ObjectId.isValid(request.getETag())
                ? new BsonObjectId(new ObjectId(request.getETag()))
                : new BsonObjectId();

        var result = dbs.deleteCollection(</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org/restheart/mongodb/handlers/database/DeleteDBHandler.java</td>
<td>restheart-mongodb</td>
<td>86</td></tr>
<tr class="b">
<td>org/restheart/mongodb/handlers/database/PatchDBHandler.java</td>
<td>restheart-mongodb</td>
<td>105</td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>etag,
            request.isETagCheckRequired());

        response.setDbOperationResult(result);

        // inject the etag
        if (result.getEtag() != null) {
            ResponseHelper.injectEtagHeader(exchange, result.getEtag());
        }

        if (result.getHttpCode() == HttpStatus.SC_CONFLICT) {
            response.setInError(HttpStatus.SC_CONFLICT, &quot;The database's ETag must be provided using the '&quot; + Headers.IF_MATCH + &quot;' header.&quot;);
            next(exchange);
            return;
        }

        response.setStatusCode(result.getHttpCode());

        MetadataCachesSingleton.getInstance().invalidateDb(request.getDBName());

        next(exchange);
    }
}</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org/restheart/cache/impl/CaffeineCache.java</td>
<td>restheart-commons</td>
<td>82</td></tr>
<tr class="b">
<td>org/restheart/cache/impl/CaffeineLoadingCache.java</td>
<td>restheart-commons</td>
<td>75</td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>return wrapped.getIfPresent(key);
    }

    @Override
    public void put(K key, V value) {
        wrapped.put(key, Optional.ofNullable(value));
    }

    @Override
    public void invalidate(K key) {
        wrapped.invalidate(key);
    }

    @Override
    public void invalidateAll() {
        wrapped.invalidateAll();
    }

    @Override
    public Map&lt;K, Optional&lt;V&gt;&gt; asMap() {
        return wrapped.asMap();
    }

    @Override
    public void cleanUp() {
        wrapped.cleanUp();
    }
}</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org/restheart/mongodb/handlers/document/PatchDocumentHandler.java</td>
<td>restheart-mongodb</td>
<td>88</td></tr>
<tr class="b">
<td>org/restheart/mongodb/handlers/document/PutDocumentHandler.java</td>
<td>restheart-mongodb</td>
<td>99</td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>var result = documents.writeDocument(
            Optional.ofNullable(request.getClientSession()),
            request.rsOps(),
            request.getDBName(),
            request.getCollectionName(),
            request.getMethod(),
            request.getWriteMode(),
            Optional.of(request.getDocumentId()),
            Optional.ofNullable(request.getFiltersDocument()),
            Optional.ofNullable(request.getShardKey()),
            content,
            request.getETag(),
            request.isETagCheckRequired());

        response.setDbOperationResult(result);

        if (RequestHelper.isResponseInConflict(result, exchange)) {</pre></div></td></tr></table></section>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
        Copyright &#169;      2014&#x2013;${currentYear}<a href="https://softinstigate.com">SoftInstigate</a>.
.      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
